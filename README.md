# CFBLOG-Plus: 基于 Cloudflare Workers 和 KV 的无服务器博客

CFBLOG-Plus 是一个轻量级、高性能的无服务器博客系统。它完全构建在 Cloudflare 的全球网络之上，利用 Workers 处理后端逻辑，并使用 KV 作为数据存储，无需传统服务器。

## ✨ 主要特性

- **无服务器架构**: 无需管理服务器，由 Cloudflare 提供强大的支持和全球CDN加速。
- **数据存储**: 所有文章、分类、标签和配置均存储在 Cloudflare KV 中。
- **功能齐全的后台**:
  - 安全的 JWT 登录认证。
  - 文章的创建、编辑、删除（CRUD）功能。
  - 支持 Markdown 的在线编辑器。
  - 分类、标签、菜单和友链的可视化管理。
  - 数据导入与导出功能。
- **易于部署**: 通过 Cloudflare 的 Git 集成，可以轻松地从 GitHub 仓库一键部署。
- **低成本**: Cloudflare 的免费套餐足以支撑绝大多数个人博客的日常使用。

## 🚀 部署指南

本指南将引导您通过 Cloudflare 的网页仪表盘，将此项目从您的 GitHub 仓库部署为线上博客。

### 准备工作

1.  **一个 Cloudflare 账户**: [注册 Cloudflare](https://dash.cloudflare.com/sign-up)。
2.  **一个 GitHub 账户**: [注册 GitHub](https://github.com/join)。

---

### 第一步：将项目上传到 GitHub

1.  在 GitHub 上创建一个新的**私有**或**公开**仓库（例如，`my-cf-blog`）。
2.  将本项目的所有文件（`worker.js`、`wrangler.toml`、`themes` 目录和 `logo` 目录）上传到您刚刚创建的 GitHub 仓库中。

---

### 第二步：创建 Cloudflare KV 存储桶

博客的所有数据都将存储在 KV 中。

1.  登录到您的 Cloudflare 仪表盘。
2.  在左侧菜单中，导航到 **Workers 和 Pages** > **KV**。
3.  点击 **创建命名空间**。
4.  输入一个命名空间名称，例如 `CFBLOG_KV`，然后点击 **创建**。

---

### 第三步：创建并部署 Worker

1.  在 Cloudflare 仪表盘的左侧菜单中，导航到 **Workers 和 Pages**。
2.  点击 **创建应用程序**，然后选择 **Workers** 选项卡。
3.  点击 **连接到 Git**。
4.  选择您在第一步中创建的 GitHub 仓库，然后点击 **开始设置**。
5.  为您的 Worker 命名（例如，`my-blog-worker`），生产分支选择 `main`（或您的主分支）。
6.  在 **构建和部署命令** 部分，进行如下设置：
    -   **构建命令**: **留空**。
    -   **部署命令**: **`npx wrangler deploy`** (所有配置均已在 `wrangler.toml` 中定义)。
7.  点击 **部署**。Cloudflare 会自动完成首次部署。

---

### 第四步：配置 Worker

这是最关键的一步，您需要将 KV 存储桶和环境变量连接到您的 Worker。

1.  部署完成后，在 Worker 的管理页面，点击 **设置** 选项卡。
2.  在设置页面中，选择 **变量** 子菜单。

#### 1. 绑定 KV 命名空间

这是为了让 Worker 知道在哪里存储数据。

-   向下滚动到 **KV 命名空间绑定** 部分。
-   点击 **添加绑定**。
-   **变量名称**: 必须输入 `CFBLOG` (大小写敏感)。
-   **KV 命名空间**: 从下拉列表中选择您在第二步创建的 `CFBLOG_KV`。
-   点击 **保存并部署**。

#### 2. 添加环境变量（后台登录信息）

这是为了设置您后台的登录账户和密码。

-   向上滚动到 **环境变量** 部分。
-   点击 **添加变量**，并依次添加以下三个变量（点击“加密”可以保护您的密码等敏感信息）：
    -   `BLOG_USER`: 您的后台登录用户名。
    -   `BLOG_PASSWORD`: 您的后台登录密码。
    -   `BLOG_JWT_SECRET`: 一个用于登录认证的**强随机字符串**。您可以使用在线密码生成器创建一个长而复杂的字符串。
-   每次添加后，都要点击 **保存并部署**。

#### 3. (可选) 添加缓存清理变量

如果您希望在发布、修改或删除文章后能自动清理 Cloudflare 的 CDN 缓存，请配置此项。

-   首先，您需要创建一个 API 令牌：
    1.  点击右上角您的头像，选择 **我的个人资料** > **API 令牌**。
    2.  点击 **创建令牌**，然后使用 **编辑区域 Worker** 模板。
    3.  在 **区域资源** 中，选择您希望部署博客的域名。
    4.  继续以创建令牌，并**复制生成的令牌**。
-   然后，获取您的 Zone ID：
    1.  回到 Cloudflare 仪表盘主页，点击您的域名。
    2.  在右侧的 **API** 部分，您会看到 **区域 ID**，点击复制。
-   最后，回到 Worker 的 **设置** > **变量** 页面，添加以下两个变量：
    -   `BLOG_CACHE_TOKEN`: 粘贴您刚刚创建的 API 令牌。
    -   `BLOG_CACHE_ZONE_ID`: 粘贴您的区域 ID。
-   点击 **保存并部署**。

---

### 第五步：访问您的博客

至此，您的博客已经部署并配置完成！

-   **访问后台**: 在浏览器中打开 `https://<您的-Worker-名称>.<您的-Cloudflare-子域>.workers.dev/admin`。
-   **登录**: 使用您在第四步中设置的 `BLOG_USER` 和 `BLOG_PASSWORD` 进行登录。
-   **开始使用**: 登录后，您可以开始新建文章、进行各项设置了。

祝您写作愉快！